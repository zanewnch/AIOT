# Kong 配置檔案

# 基本設定
database = off
declarative_config = /kong/declarative/kong.yml
declarative_config_string = 

# 監聽端口
proxy_listen = 0.0.0.0:8000, 0.0.0.0:8443 ssl
admin_listen = 0.0.0.0:8001, 0.0.0.0:8444 ssl

# 日誌設定
log_level = info
proxy_access_log = /dev/stdout
proxy_error_log = /dev/stderr
admin_access_log = /dev/stdout
admin_error_log = /dev/stderr

# 性能設定
worker_processes = auto
worker_connections = 16384

# 代理設定
real_ip_header = X-Real-IP
real_ip_recursive = on
trusted_ips = 0.0.0.0/0,::/0

# 安全設定
nginx_worker_processes = auto
nginx_daemon = off

# SSL 設定 (如果需要)
ssl = on
ssl_cert = /kong/ssl/server.crt
ssl_cert_key = /kong/ssl/server.key

# Lua 設定
lua_package_path = /opt/?.lua;/opt/?/init.lua;;
lua_ssl_verify_depth = 1

# 上游設定
upstream_keepalive = 60
upstream_keepalive_pool_size = 30

# 插件設定
plugins = bundled,prometheus,request-id,cors,rate-limiting,request-size-limiting

# 健康檢查
health_checks_active_healthy_interval = 0
health_checks_active_unhealthy_interval = 0

# DNS 設定
dns_resolver = 127.0.0.11
dns_hostsfile = /etc/hosts
dns_order = LAST,SRV,A,CNAME