# AIOT å¾®æœå‹™æ¸¬è©¦å¥—ä»¶

å®Œæ•´çš„å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦æ¡†æ¶ï¼Œç”¨æ–¼é©—è­‰ AIOT å¾®æœå‹™æ¶æ§‹çš„åŠŸèƒ½æ­£ç¢ºæ€§å’Œç³»çµ±ç©©å®šæ€§ã€‚

## ğŸ“‹ æ¸¬è©¦æ¦‚è¦½

### æ¸¬è©¦çµ±è¨ˆ
- **ç¸½æ¸¬è©¦æª”æ¡ˆ**: 15 å€‹
- **å–®å…ƒæ¸¬è©¦**: 10 å€‹æª”æ¡ˆ (250+ å€‹æ¸¬è©¦æ¡ˆä¾‹)
- **æ•´åˆæ¸¬è©¦**: 5 å€‹æª”æ¡ˆ (136+ å€‹æ¸¬è©¦æ¡ˆä¾‹)  
- **ç¸½æ¸¬è©¦æ¡ˆä¾‹**: 386+ å€‹

### æœå‹™è¦†è“‹
- âœ… **Drone Service** - ç„¡äººæ©Ÿæœå‹™æ¸¬è©¦
- âœ… **RBAC Service** - æ¬Šé™æ§åˆ¶æœå‹™æ¸¬è©¦  
- âœ… **General Service** - é€šç”¨æœå‹™æ¸¬è©¦
- âœ… **Docs Service** - æ–‡æª”æœå‹™æ¸¬è©¦
- âœ… **Drone WebSocket Service** - ç„¡äººæ©Ÿ WebSocket æœå‹™æ¸¬è©¦

## ğŸ—ï¸ æ¸¬è©¦æ¶æ§‹

```
test/
â”œâ”€â”€ unit/                     # å–®å…ƒæ¸¬è©¦
â”‚   â”œâ”€â”€ drone-service/
â”‚   â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ services/         # æœå‹™å±¤æ¸¬è©¦
â”‚   â”œâ”€â”€ rbac-service/
â”‚   â”‚   â”œâ”€â”€ controllers/      # ç”¨æˆ¶ç®¡ç†æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ services/         # RBAC é‚è¼¯æ¸¬è©¦
â”‚   â”œâ”€â”€ general-service/
â”‚   â”‚   â”œâ”€â”€ controllers/      # é€šç”¨æ§åˆ¶å™¨æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ services/         # é€šç”¨æœå‹™æ¸¬è©¦
â”‚   â”œâ”€â”€ docs-service/
â”‚   â”‚   â”œâ”€â”€ controllers/      # æ–‡æª”æ§åˆ¶å™¨æ¸¬è©¦
â”‚   â”‚   â””â”€â”€ services/         # æ–‡æª”ç”Ÿæˆæœå‹™æ¸¬è©¦
â”‚   â””â”€â”€ drone-websocket-service/
â”‚       â””â”€â”€ services/         # WebSocket æœå‹™æ¸¬è©¦
â”œâ”€â”€ integration/              # æ•´åˆæ¸¬è©¦
â”‚   â”œâ”€â”€ api/                  # API æ•´åˆæ¸¬è©¦
â”‚   â”‚   â”œâ”€â”€ auth.integration.test.ts
â”‚   â”‚   â”œâ”€â”€ drone.integration.test.ts
â”‚   â”‚   â”œâ”€â”€ rbac.integration.test.ts
â”‚   â”‚   â”œâ”€â”€ docs.integration.test.ts
â”‚   â”‚   â””â”€â”€ drone-websocket.integration.test.ts
â”‚   â””â”€â”€ setup/                # æ¸¬è©¦ç’°å¢ƒè¨­å®š
â”‚       â””â”€â”€ testSetup.ts      # æ•´åˆæ¸¬è©¦æ¡†æ¶
â”œâ”€â”€ setup/                    # æ¸¬è©¦é…ç½®
â”‚   â””â”€â”€ jest.setup.ts         # Jest å…¨åŸŸè¨­å®š
â”œâ”€â”€ jest.config.js            # Jest é…ç½®
â”œâ”€â”€ package.json              # æ¸¬è©¦ä¾è³´
â”œâ”€â”€ run-tests.sh              # æ¸¬è©¦åŸ·è¡Œè…³æœ¬
â””â”€â”€ validate-tests.js         # æ¸¬è©¦é©—è­‰å·¥å…·
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å®‰è£ä¾è³´
```bash
cd microServices/test
npm install
```

### 2. åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
```bash
npm test
```

### 3. åŸ·è¡Œç‰¹å®šæ¸¬è©¦é¡å‹
```bash
# åƒ…åŸ·è¡Œå–®å…ƒæ¸¬è©¦
npm run test:unit

# åƒ…åŸ·è¡Œæ•´åˆæ¸¬è©¦  
npm run test:integration

# åŸ·è¡Œæ¸¬è©¦ä¸¦ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage
```

### 4. ä½¿ç”¨æ¸¬è©¦åŸ·è¡Œè…³æœ¬
```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
./run-tests.sh

# åƒ…åŸ·è¡Œå–®å…ƒæ¸¬è©¦
./run-tests.sh unit

# åƒ…åŸ·è¡Œæ•´åˆæ¸¬è©¦
./run-tests.sh integration
```

## ğŸ§ª å–®å…ƒæ¸¬è©¦

### Drone Service æ¸¬è©¦
- **DroneCommandCommandsCtrl.test.ts** - ç„¡äººæ©ŸæŒ‡ä»¤æ§åˆ¶å™¨æ¸¬è©¦
  - æŒ‡ä»¤å‰µå»ºå’Œé©—è­‰
  - æ‰¹é‡æ“ä½œæ¸¬è©¦
  - é£›è¡ŒæŒ‡ä»¤ç™¼é€æ¸¬è©¦
  - æ¬Šé™æ§åˆ¶æ¸¬è©¦
  
- **DroneCommandCommandsSvc.test.ts** - ç„¡äººæ©ŸæŒ‡ä»¤æœå‹™æ¸¬è©¦
  - æ¥­å‹™é‚è¼¯æ¸¬è©¦
  - æŒ‡ä»¤ç‹€æ…‹ç®¡ç†
  - éŒ¯èª¤è™•ç†æ¸¬è©¦

### RBAC Service æ¸¬è©¦  
- **UserCommandsCtrl.test.ts** - ç”¨æˆ¶ç®¡ç†æ§åˆ¶å™¨æ¸¬è©¦
  - ç”¨æˆ¶ CRUD æ“ä½œ
  - å¯†ç¢¼ç®¡ç†
  - æ¬Šé™é©—è­‰
  
- **UserCommandsSvc.test.ts** - ç”¨æˆ¶ç®¡ç†æœå‹™æ¸¬è©¦
  - ç”¨æˆ¶å‰µå»ºå’Œé©—è­‰
  - å¯†ç¢¼åŠ å¯†æ¸¬è©¦
  - Redis å¿«å–ç®¡ç†

### General Service æ¸¬è©¦
- **UserPreferenceCommandsCtrl.test.ts** - ç”¨æˆ¶åå¥½æ§åˆ¶å™¨æ¸¬è©¦
  - åå¥½è¨­å®š CRUD
  - æ‰¹é‡æ“ä½œ
  - è¼¸å…¥é©—è­‰
  
- **UserPreferenceCommandsSvc.test.ts** - ç”¨æˆ¶åå¥½æœå‹™æ¸¬è©¦
  - åå¥½è¨­å®šé‚è¼¯
  - é è¨­å€¼è™•ç†
  - æ•¸æ“šé·ç§»

### Docs Service æ¸¬è©¦
- **DocsController.test.ts** - æ–‡æª”æ§åˆ¶å™¨æ¸¬è©¦
  - æ–‡æª”é¦–é æ¸²æŸ“
  - æ‰‹å‹•æ–‡æª”ç”Ÿæˆ
  - ç”Ÿæˆç‹€æ…‹æŸ¥è©¢
  - é‡å®šå‘åŠŸèƒ½
  
- **DocsGenerationService.test.ts** - æ–‡æª”ç”Ÿæˆæœå‹™æ¸¬è©¦
  - æ–‡æª”æ›´æ–°æª¢æŸ¥é‚è¼¯
  - æ–‡æª”ç”Ÿæˆæµç¨‹
  - æ–‡ä»¶ç³»çµ±æ“ä½œ
  - å‘½ä»¤åŸ·è¡Œå’ŒéŒ¯èª¤è™•ç†

### Drone WebSocket Service æ¸¬è©¦
- **DroneRealTimeStatusCommandsSvc.test.ts** - å³æ™‚ç‹€æ…‹å‘½ä»¤æœå‹™æ¸¬è©¦
  - ç‹€æ…‹æ›´æ–°åŠŸèƒ½
  - è¼¸å…¥é©—è­‰
  - éŒ¯èª¤è™•ç†
  - æ¥­å‹™é‚è¼¯é©—è­‰
  
- **DroneRealTimeStatusQueriesSvc.test.ts** - å³æ™‚ç‹€æ…‹æŸ¥è©¢æœå‹™æ¸¬è©¦
  - ç‹€æ…‹æŸ¥è©¢åŠŸèƒ½
  - åœ¨ç·šç‹€æ…‹ç›£æ§
  - å¥åº·ç‹€æ…‹è©•ä¼°
  - è¼¸å…¥é©—è­‰å’ŒéŒ¯èª¤è™•ç†

## ğŸŒ æ•´åˆæ¸¬è©¦

### èªè­‰æ•´åˆæ¸¬è©¦ (auth.integration.test.ts)
- ç”¨æˆ¶è¨»å†Šæµç¨‹
- ç™»å…¥é©—è­‰æ©Ÿåˆ¶
- JWT Token ç®¡ç†
- æ¬Šé™é©—è­‰
- è·¨æœå‹™èªè­‰
- å®‰å…¨æ€§æ¸¬è©¦

### ç„¡äººæ©Ÿ API æ•´åˆæ¸¬è©¦ (drone.integration.test.ts)
- ç„¡äººæ©ŸåŸºæœ¬è³‡è¨Šç®¡ç†
- æŒ‡ä»¤ç™¼é€å’ŒåŸ·è¡Œ
- ç‹€æ…‹è¿½è¹¤
- ä½ç½®è¨˜éŒ„
- æ‰¹é‡æ“ä½œ
- çµ±è¨ˆè³‡æ–™

### RBAC API æ•´åˆæ¸¬è©¦ (rbac.integration.test.ts)  
- ç”¨æˆ¶ç®¡ç† API
- è§’è‰²æ¬Šé™ç®¡ç†
- ç”¨æˆ¶è§’è‰²åˆ†é…
- æ¬Šé™é©—è­‰
- å¯†ç¢¼ç®¡ç†
- ç³»çµ±çµ±è¨ˆ

### æ–‡æª” API æ•´åˆæ¸¬è©¦ (docs.integration.test.ts)
- æ–‡æª”é¦–é æ¸²æŸ“æ¸¬è©¦
- æ‰‹å‹•æ–‡æª”ç”Ÿæˆ API æ¸¬è©¦
- ç”Ÿæˆç‹€æ…‹æŸ¥è©¢ API æ¸¬è©¦
- å¥åº·æª¢æŸ¥æ¸¬è©¦
- éŒ¯èª¤è™•ç†æ¸¬è©¦

### ç„¡äººæ©Ÿ WebSocket API æ•´åˆæ¸¬è©¦ (drone-websocket.integration.test.ts)
- WebSocket é€£æ¥æ¸¬è©¦
- å³æ™‚ç‹€æ…‹æŸ¥è©¢ API æ¸¬è©¦
- å¥åº·æª¢æŸ¥æ¸¬è©¦
- WebSocket å¯¦æ™‚é€šä¿¡æ¸¬è©¦
- éŒ¯èª¤è™•ç†æ¸¬è©¦

## âš™ï¸ æ¸¬è©¦é…ç½®

### Jest é…ç½®ç‰¹é»
- **TypeScript æ”¯æ´** - å®Œæ•´çš„ TS æ¸¬è©¦ç’°å¢ƒ
- **ES Module ç›¸å®¹** - æ”¯æ´ç¾ä»£ JavaScript æ¨¡çµ„
- **åˆ†é›¢åŸ·è¡Œç’°å¢ƒ** - å–®å…ƒæ¸¬è©¦ä¸¦è¡Œï¼Œæ•´åˆæ¸¬è©¦åºåˆ—
- **è¦†è“‹ç‡å ±å‘Š** - è©³ç´°çš„ä»£ç¢¼è¦†è“‹ç‡çµ±è¨ˆ
- **å¤šæ ¼å¼å ±å‘Š** - HTMLã€LCOVã€JSON æ ¼å¼

### è¦†è“‹ç‡é–€æª»
- **è¡Œè¦†è“‹ç‡**: 70%
- **å‡½æ•¸è¦†è“‹ç‡**: 70%  
- **åˆ†æ”¯è¦†è“‹ç‡**: 70%
- **èªå¥è¦†è“‹ç‡**: 70%

## ğŸ”§ æ¸¬è©¦å·¥å…·

### æ¸¬è©¦åŸ·è¡Œè…³æœ¬ (run-tests.sh)
- è‡ªå‹•åŒ–æ¸¬è©¦ç’°å¢ƒè¨­ç½®
- è³‡æ–™åº«åˆå§‹åŒ–å’Œæ¸…ç†
- Docker æœå‹™ç®¡ç†
- æ¸¬è©¦å ±å‘Šç”Ÿæˆ

### æ¸¬è©¦é©—è­‰å·¥å…· (validate-tests.js)
- æ¸¬è©¦çµæ§‹é©—è­‰
- é…ç½®æ­£ç¢ºæ€§æª¢æŸ¥  
- è¦†è“‹ç‡çµ±è¨ˆåˆ†æ
- æ¸¬è©¦å“è³ªè©•ä¼°

### æ¸¬è©¦è¨­ç½®æ¡†æ¶ (testSetup.ts)
- HTTP å®¢æˆ¶ç«¯ç®¡ç†
- è³‡æ–™åº«é€£æ¥ç®¡ç†
- æ¸¬è©¦è³‡æ–™å»ºç«‹
- èªè­‰ç®¡ç†
- ç’°å¢ƒæ¸…ç†

## ğŸ› ï¸ Mock å’Œå·¥å…·

### å…¨åŸŸ Mock
- **Logger** - çµ±ä¸€æ—¥èªŒ Mock
- **Database** - MySQLã€MongoDBã€Redis Mock  
- **Authentication** - bcryptã€JWT Mock
- **HTTP** - Expressã€Axios Mock

### æ¸¬è©¦è¼”åŠ©å·¥å…·
- **è‡ªå®šç¾©åŒ¹é…å™¨** - æ—¥æœŸã€Emailã€UUID é©—è­‰
- **æ¸¬è©¦è³‡æ–™ç”Ÿæˆ** - éš¨æ©Ÿå­—ç¬¦ä¸²ã€æ•¸å­—ç”Ÿæˆ
- **æ™‚é–“æ¨¡æ“¬** - æ™‚é–“æˆ³å·®ç•°é©—è­‰
- **éŒ¯èª¤è™•ç†** - çµ±ä¸€ç•°å¸¸æ•ç²

## ğŸ“Š æ¸¬è©¦å ±å‘Š

### å ±å‘Šæ ¼å¼
- **æ§åˆ¶å°è¼¸å‡º** - å¯¦æ™‚æ¸¬è©¦çµæœ
- **HTML å ±å‘Š** - è©³ç´°çš„æ¸¬è©¦å ±å‘Šé é¢
- **JUnit XML** - CI/CD æ•´åˆæ ¼å¼
- **JSON ç¸½çµ** - ç¨‹å¼åŒ–è™•ç†æ ¼å¼

### è¦†è“‹ç‡å ±å‘Š
```bash
# æŸ¥çœ‹è¦†è“‹ç‡å ±å‘Š
open coverage/lcov-report/index.html

# æŸ¥çœ‹æ¸¬è©¦çµæœ
open test-results/test-report.html
```

## ğŸš§ CI/CD æ•´åˆ

### GitHub Actions
```yaml
- name: Run Tests
  run: |
    cd microServices/test
    npm install
    npm run test:ci
```

### Docker ç’°å¢ƒ
```bash
# ä½¿ç”¨ Docker åŸ·è¡Œæ¸¬è©¦
docker-compose -f docker-compose.test.yml up --abort-on-container-exit
```

## ğŸ“ˆ æ¸¬è©¦æœ€ä½³å¯¦è¸

### å–®å…ƒæ¸¬è©¦åŸå‰‡
- **ç¨ç«‹æ€§** - æ¯å€‹æ¸¬è©¦éƒ½æ˜¯ç¨ç«‹çš„
- **å¯é‡è¤‡** - æ¸¬è©¦çµæœæ‡‰è©²ä¸€è‡´
- **å¿«é€ŸåŸ·è¡Œ** - å–®å…ƒæ¸¬è©¦æ‡‰è©²å¿«é€Ÿå®Œæˆ
- **æ¸…æ™°æè¿°** - æ¸¬è©¦åç¨±æ‡‰è©²æè¿°æ¸¬è©¦æ„åœ–

### æ•´åˆæ¸¬è©¦åŸå‰‡  
- **çœŸå¯¦ç’°å¢ƒ** - æ¨¡æ“¬çœŸå¯¦çš„æœå‹™ç’°å¢ƒ
- **æ•¸æ“šéš”é›¢** - æ¯å€‹æ¸¬è©¦ä½¿ç”¨ç¨ç«‹çš„æ¸¬è©¦è³‡æ–™
- **å®Œæ•´æµç¨‹** - æ¸¬è©¦ç«¯åˆ°ç«¯çš„æ¥­å‹™æµç¨‹
- **éŒ¯èª¤æ¢å¾©** - æ¸¬è©¦ç³»çµ±çš„éŒ¯èª¤è™•ç†èƒ½åŠ›

### Mock ç­–ç•¥
- **å¤–éƒ¨ä¾è³´** - Mock æ‰€æœ‰å¤–éƒ¨æœå‹™
- **è³‡æ–™åº«æ“ä½œ** - ä½¿ç”¨ in-memory æˆ– Mock è³‡æ–™åº«
- **ç¶²è·¯è«‹æ±‚** - Mock HTTP è«‹æ±‚å’ŒéŸ¿æ‡‰
- **æ™‚é–“ç›¸é—œ** - Mock æ™‚é–“å‡½æ•¸é¿å…æ¸¬è©¦ä¸ç©©å®š

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. TypeScript ç·¨è­¯éŒ¯èª¤
```bash
# æª¢æŸ¥ tsconfig.json é…ç½®
npx tsc --noEmit

# æ›´æ–°é¡å‹å®šç¾©
npm update @types/jest @types/node
```

#### 2. ES Module éŒ¯èª¤
```bash
# ç¢ºèª package.json ä¸­çš„ "type": "module"
# æª¢æŸ¥ jest.config.js ä¸­çš„ ES Module é…ç½®
```

#### 3. æ¸¬è©¦é€¾æ™‚
```bash
# å¢åŠ æ¸¬è©¦é€¾æ™‚æ™‚é–“
jest.setTimeout(30000)

# æˆ–åœ¨ jest.config.js ä¸­è¨­å®š
testTimeout: 30000
```

#### 4. Mock ä¸ç”Ÿæ•ˆ
```bash
# æ¸…é™¤ Jest å¿«å–
npx jest --clearCache

# æª¢æŸ¥ Mock è·¯å¾‘æ˜¯å¦æ­£ç¢º
```

### èª¿è©¦æŠ€å·§
- ä½¿ç”¨ `console.log` é€²è¡Œèª¿è©¦
- ä½¿ç”¨ `--runInBand` åºåˆ—åŸ·è¡Œæ¸¬è©¦
- ä½¿ç”¨ `--verbose` é¡¯ç¤ºè©³ç´°ä¿¡æ¯
- ä½¿ç”¨ `--detectOpenHandles` æª¢æ¸¬è³‡æºæ´©æ¼

## ğŸ“š åƒè€ƒè³‡æº

- [Jest å®˜æ–¹æ–‡æª”](https://jestjs.io/docs/getting-started)
- [TypeScript Jest é…ç½®](https://jestjs.io/docs/getting-started#using-typescript)  
- [Supertest API æ¸¬è©¦](https://github.com/visionmedia/supertest)
- [æ¸¬è©¦æœ€ä½³å¯¦è¸](https://github.com/goldbergyoni/javascript-testing-best-practices)

## ğŸ¤ è²¢ç»æŒ‡å—

### æ–°å¢æ¸¬è©¦
1. éµå¾ªç¾æœ‰çš„æª”æ¡ˆçµæ§‹
2. ä½¿ç”¨æè¿°æ€§çš„æ¸¬è©¦åç¨±
3. åŒ…å«æ­£é¢å’Œè² é¢æ¸¬è©¦æ¡ˆä¾‹  
4. æ·»åŠ é©ç•¶çš„ Mock å’Œæ¸…ç†

### æ¸¬è©¦è¦†è“‹ç‡
- æ–°åŠŸèƒ½å¿…é ˆåŒ…å«å°æ‡‰æ¸¬è©¦
- ç¶­æŒ 70% ä»¥ä¸Šçš„è¦†è“‹ç‡
- å„ªå…ˆæ¸¬è©¦é—œéµæ¥­å‹™é‚è¼¯
- åŒ…å«é‚Šç•Œæ¢ä»¶æ¸¬è©¦

---

**ç‰ˆæœ¬**: 1.0.0  
**ä½œè€…**: AIOT Team  
**æœ€å¾Œæ›´æ–°**: 2025-08-13